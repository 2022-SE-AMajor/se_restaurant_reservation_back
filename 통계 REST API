현시점에서 작성한 통계의 REST API 입니다. 발생할 수 있는 예외 상황이 많아서 틀만 올려놓고 고쳐나가겠습니다. 데이터베이스에 세부사항을 추가 혹은 변경함에 따라 내용도 수정될 수 있습니다.
url: localhost:4000/

stat

PUT /stat

insertStat: 통계 조회 직전에 오늘에 해당하는 연도와 달(이하 thisYM)을 키값으로 갖고 있는 통계를 생성합니다.

RESPONSE
result & message: 통계 생성 완료

ERROR
51 / message: 통계를 가져오고 있습니다.
이미 존재하는 thisYM의 통계는 sql문 특성상 생성을 못합니다. 그래서 예외 처리 메세지를 "통계를 가져오고 있습니다."로 설정했습니다.
이러면 서버나 다른 문제로 예외 상황이 발생해도 어색하지 않은 문구라고 생각합니다.



PATCH /stat

updating: thisYM의 통계를 갱신합니다. 당장은 노쇼 여부와 요일, 인원수까지 따로 받아야하지만 외부 테이블의 키값을 참조할 수 있다는 걸 방금 알았습니다. 곧 개선 예정.
아직 갱신 시점을 못 정했습니다. 뭘로 정하냐에 따라 주소가 변동될 가능성이 있습니다. 노쇼 여부를 알려면 삭제 직전에 갱신하는 게 편할 거라 생각합니다.

RESPONSE
result & message: 갱신 완료

ERROR
57 / message: 갱신 실패

BODY 예시
{
        "year_month": 202205,
        "no_show": true,
        "day": "목",
        "people": 3
}



GET /stat

showStat: 선택한 달(이하 chosenYM)의 통계의 기본 화면을 보여줍니다. 여기서 기본 화면은 노쇼, 요일별, 인원별 예약 통계를 한 번에 보여주는 화면을 말합니다.
위의 것들이랑 주소가 같은데 PUT PATCH GET등등 주소가 같아도 행동이 다르면 작동할지 궁금해서 설정해봤습니다. 이것도 오류 나면 수정 예정.
여기서 보여주는 노쇼 통계는 아직 구체화 못했는데 어차피 종합이니 안 보여줘도 상관없을 수도?

RESPONSE
result: chosenYM에 해당하는 통계, select * from stat where `year_month`=`chosenYM`
message: 통계 조회 성공

ERROR
49 / message: 선택한 달의 통계가 없습니다.
50 / message: 선택한 달의 정보가 충분하지 않습니다.
통계가 없으면 49번 오류, chosenYM의 통계의 month_total이 0이면 50번 오류에 해당합니다. 평균을 구할 때 month_total을 이용해서 나누기 때문에 둘을 따로 구분했습니다.
52 / message: 통계 조회 실패

BODY 예시
{
        "year_month": 202205
}



GET /stat/abs

showNoShowStat: chosenYM의 총 예약 수, 노쇼 횟수, 노쇼 비율, 지날 달 대비 상승/하락율을 출력합니다.

RESPONSE
result: this_total, this_noshow(select no_show from stat where `year_month`=`chosenYM`), this_rate, comp_rate
message: 노쇼 통계 조회 성공

ERROR
49 / message: 선택한 달의 통계가 없습니다.
50 / message: 선택한 달의 정보가 충분하지 않습니다.
52 / message: 통계 조회 실패

BODY 예시
{
        "year_month": 202205
}



GET /stat/day

showDayOfWeekStat: chosenYM의 요일별 예약 횟수를 출력합니다.

RESPONSE
result: select Mon, Tue, Wed, Thu, Fri, Sat, Sun from stat where `year_month`=`chosenYM`
message: 요일별 통계 조회 성공

ERROR
49 / message: 선택한 달의 통계가 없습니다.
50 / message: 선택한 달의 정보가 충분하지 않습니다.
52 / message: 통계 조회 실패

BODY 예시
{
        "yeat_month": 202205
}



GET /stat/num

showNumOfCustStat: chosenYM의 인원별 예약 횟수, 평균 인원을 출력합니다.

RESPONSE
result: (select oneC, twoC, threeC, fourC, fiveC, sixC, sevenC, eightC from stat where `year_month`=`chosenYM`), avg
message: 인원별 통계 조회 성공

ERROR
49 / message: 선택한 달의 통계가 없습니다.
50 / message: 선택한 달의 정보가 충분하지 않습니다.
52 / message: 통계 조회 실패

BODY 예시
{
        "yeat_month": 202205
}



GET /stat/all

showAllStat: 위의 것들은 chosenYM의 통계만 보여주었다면 이번엔 지금까지 기록한 모든 통계를 보여줍니다.
딱히 구현할 필요는 없었지만 만들기 쉬워서 넣어봤습니다.

RESPONSE
result: select * from stat
message: 모든 통계 조회 성공

ERROR
52 / message: 통계 조회 실패

BODY 예시
{
        "yeat_month": 202205
}
